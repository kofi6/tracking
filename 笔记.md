# 笔记

[TOC]

## 提问
### 10.20日（未解决）
1.KCF算法中，带宽（方差）影响着追踪的鲁棒性，那么也就是说，在“不丢失目标”这个前提下，程序进行了自适应带宽调整，这个调整是如何进行的？



## 目标丢失判据
### res
在西安电子科大刘志强的《基于核相关滤波的高速目标跟踪算法研究与系统实现》论文中，采用了第一帧响应A和当前响应B来作为判决依据，A应大于等于0.2，B应大于等于0.8，文中并未提到是如何将响应的高斯矩阵变成一个数字的，但判决思路可以作为参考。

考虑图片造假，以我目前的了解，KCF中的高斯函数不可能产生任何一个位于0到1之间的特征值可以用作判据。



### PSR
略
###　APCE
LMCF算法提出了一个叫做APCE的丢失判据。
https://blog.csdn.net/weixin_38128100/article/details/88327092/

在冷正立《融合Yolov5和改进KCF算法的抗遮挡目标跟踪系统研究》论文中，提出了使用CN判据，并在CN判据的前提下对APEC判据和PSR判据的阈值进行评价。

APCE可以评估当前高斯矩阵的波动程度，参考上述链接当中的图。
## 归一化问题
`res = (res - res.min())/(res.max()-res.min()`

使用这个归一化方法后，响应矩阵丢失了原本的高斯特性，只是单纯为了可视化。

这样归一化产生的高斯图只能反应出其他背景与当前追踪目标的相似程度，而不能反映出当前追踪效果。我认为应该采用高斯分布的特性，即积分后为1，作为归一化的最大值。



根据测试结果可知（其实应该是根据原理，但是实在是不太懂原理），高斯响应矩阵为连续高斯函数的离散取值，因为高斯响应矩阵的所有元素和不为1。

但高斯核函数在高维空间，对高斯核函数进行归一化似乎难度较大。

考虑到高斯响应图的意义与目标丢失判据的计算，提出以下方案：考虑采取舍弃一些精度，将高斯矩阵转变为离散高斯分布，具体来说，上述归一化变为如下操作：

```python
matrix_sum = np.sum(res) 
res = (res - res.min())/(res.max()-res.min())
res=res/matrix_sum
```

实际测试，每次matrix_sum均有0.9+，舍弃精度不大。

### 补充

上述关于归一化问题的思路是错误的，归一化并不消除数据本身的特性。高斯分布可视化图也是通过亮斑的大小来展示带宽，从而展示当前高斯分布的集中程度。

现有的高斯函数是经过了变换后的高斯函数

## 10.21记录


理论工作：
加入使用APCE作为判据。

缺点：

不归一。由于高斯核函数在高维空间，进行非线性变换更新，当高斯核函数变化较大时无法合理的评价两个响应矩阵，无法实现理论闭合。

考虑加入其他判据，如res峰值。

确定跟踪错误类型，遮挡、消失或旋转等。遮挡还分为部分遮挡，严重遮挡，短时遮挡，长时遮挡等。错误类型决定了高斯响应的错误特征。需要使用不同的判据来识别不同的特征。

代码工作：
将鼠标回调函数恢复到选择结构当中，并加入回调函数右键为暂停更新模型，目的是为了计算在不同情况下的APCE值。

确定具体门限值。思路一：根据经验选择固定门限值 思路二：根据历史最高值动态调整，具体操作方法仍需讨论。

停止更新模型但要持续追踪，要将更新和追踪分开来。思路一：此时copy一个对象，将临时模型用作暂时追踪。缺点：无法加速。因为暂停更新理论上应该要加速识别，提高性能。思路二：重构KCF核心代码

## 10.22日晚
### 实现
1.鼠标选框与yolo切换
2.判决结果作为训练函数参数，判断是否继续训练
### 问题
当模型不更新时，会出现一直无法获得高响应的情况。可以通过引入YOLO参加训练解决该问题。
### todo
当目标丢失时，将yolo加入
